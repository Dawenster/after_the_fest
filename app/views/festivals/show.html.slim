css:
  body {
    background-color: #{@festival.background_colour} !important;
  }

= render "layouts/header"
.row
  - @festival.films.each_with_index do |film, i|
    .col-lg-3.col-md-4.col-sm-6.col-xs-12 style="padding: 0;"
      .film-grid-holder
        i.fa.fa-info-circle.fa-3x.touch-info.visible-lg.hidden data-screen="lg"
        i.fa.fa-info-circle.fa-3x.touch-info.visible-md.hidden data-screen="md"
        i.fa.fa-info-circle.fa-3x.touch-info.visible-sm.hidden data-screen="sm"
        i.fa.fa-info-circle.fa-3x.touch-info.visible-xs.hidden data-screen="xs"

        .play-button.hidden

        .film-grid-item.visible-lg style="background-image:url(#{film.image.url(:display)});" data-url="#{public_film_path(film.festival.slug, film.slug)}" title="#{film.name}" data-content="#{film.popover_content}" data-placement="" data-count="#{i+1}" data-screen="lg" data-animate="false" data-html="true"

        .film-grid-item.visible-md style="background-image:url(#{film.image.url(:display)});" data-url="#{public_film_path(film.festival.slug, film.slug)}" title="#{film.name}" data-content="#{film.popover_content}" data-placement="" data-count="#{i+1}" data-screen="md" data-animate="false" data-html="true"

        .film-grid-item.visible-sm style="background-image:url(#{film.image.url(:display)});" data-url="#{public_film_path(film.festival.slug, film.slug)}" title="#{film.name}" data-content="#{film.popover_content}" data-placement="" data-count="#{i+1}" data-screen="sm" data-animate="false" data-html="true"

        .film-grid-item.visible-xs style="background-image:url(#{film.image.url(:display)});" data-url="#{public_film_path(film.festival.slug, film.slug)}" title="#{film.name}" data-content="#{film.popover_content}" data-placement="" data-count="#{i+1}" data-screen="xs" data-animate="false" data-html="true"

javascript:
  $(document).ready(function() {
    var gridItems = $(".film-grid-item");
    var positionIfLast = null;
    var defaultPosition = null;

    for (var i=0; i < gridItems.length; i++) {
      currentItem = $(gridItems[i]);
      switch (currentItem.attr("data-screen")) {
        case "lg":
          positionIfLast = 4;
          var defaultPosition = "right";
          break;
        case "md":
          positionIfLast = 3;
          var defaultPosition = "right";
          break;
        case "sm":
          positionIfLast = 2;
          var defaultPosition = "right";
          break;
        case "xs":
          positionIfLast = 1;
          var defaultPosition = "bottom";
          break;
      }
      var count = parseInt(currentItem.attr("data-count"));
      if (count % positionIfLast == 0 && positionIfLast != 1) {
        defaultPosition = "left";
      }
      currentItem.attr("data-placement", defaultPosition);
    }

    $(".film-grid-item").hover(function(e) {
      $(this).popover("show");
      $(this).addClass("hovering");
      $(this).siblings(".play-button").removeClass("hidden");
    }, function(e) {
      var target = $(e.target);
      var popoverCount = setInterval(function() {
        if (!$(".popover:hover").length && !target.is(":hover")) {
          clearInterval(popoverCount);
          target.popover("hide");
          target.removeClass("hovering");
          target.siblings(".play-button").addClass("hidden");
        } else {
          target.addClass("hovering");
        }
      }, 100);
    });

    $(".touch-info").click(function(e) {
      var currentItem = null;
      switch ($(this).attr("data-screen")) {
        case "lg":
          currentItem = $(this).siblings(".visible-lg")
          break;
        case "md":
          currentItem = $(this).siblings(".visible-md")
          break;
        case "sm":
          currentItem = $(this).siblings(".visible-sm")
          break;
        case "xs":
          currentItem = $(this).siblings(".visible-xs")
          break;
      }
      for (var i=0; i < gridItems.length; i++) {
        if ($(gridItems[i]).attr("data-count") != currentItem.attr("data-count")) {
          $(gridItems[i]).popover("hide");
        }
      }
      currentItem.popover("toggle");
    });

    $(".film-grid-item").click(function(e) {
      window.location = $(this).attr("data-url");
    });

    if (Modernizr.touch) {
      $(".touch-info").removeClass("hidden");
    }
  });